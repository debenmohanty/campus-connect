<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Campus Connect</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Load internships script first -->
    <script src="assets/js/internships.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-hover: #3a56d4;
            --secondary-color: #2d3748;
            --accent-color: #00b4d8;
            --background-light: #f8f9fa;
            --text-color: #2d3748;
            --text-light: #718096;
            --success-color: #48bb78;
            --info-color: #4299e1;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-light);
            color: var(--text-color);
            min-height: 100vh;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-hover));
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin: 10px 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .menu-item:hover, .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: white;
        }

        .menu-item i {
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }

        .menu-item span {
            font-size: 0.9rem;
        }

        .logout-btn {
            margin-top: auto;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
            color: white;
            text-decoration: none;
            position: absolute;
            bottom: 20px;
            width: 100%;
        }

        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .logout-btn i {
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: all 0.3s ease;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background-color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .content-area {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            min-height: 80vh;
        }

        .content-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .hamburger {
                display: block;
            }
        }

        /* Internship Card Styles */
        .internship-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .internship-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .internship-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .internship-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }

        .company-badge {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .internship-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .internship-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .internship-description {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--text-color);
            margin: 10px 0;
        }

        .skills-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .skill-tag {
            background-color: #f1f5f9;
            color: var(--text-color);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Application Card Styles */
        .application-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.2s;
            border-left: 4px solid var(--primary-color);
            margin-bottom: 20px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 85%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background-color: #f1f5f9;
            color: var(--text-color);
        }

        /* Empty state */
        .empty-state, .error-state {
            text-align: center;
            padding: 40px 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .empty-state i, .error-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #cbd5e0;
        }

        .error-state i {
            color: var(--danger-color);
        }

        /* Button Styles */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #38a169;
        }

        .btn-outline {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        /* Faculty card styles */
        .faculty-card {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-radius: var(--border-radius);
            background-color: white;
            border: 1px solid #e2e8f0;
            margin-bottom: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .faculty-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .faculty-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-light);
        }

        .faculty-info {
            flex: 1;
        }

        .faculty-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .faculty-department {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        /* Chat styles */
        .chat-history {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message-sender {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 70%;
            width: fit-content;
        }

        .message.sent {
            align-items: flex-end;
        }

        .message.sent .message-bubble {
            background-color: var(--primary-color);
            color: white;
        }

        .message.received .message-bubble {
            background-color: #f1f5f9;
        }

        /* Dashboard cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .card-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .card-applications .card-icon {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--info-color);
        }

        .card-pending .card-icon {
            background-color: rgba(237, 137, 54, 0.1);
            color: var(--warning-color);
        }

        .card-approved .card-icon {
            background-color: rgba(72, 187, 120, 0.1);
            color: var(--success-color);
        }

        .card-rejected .card-icon {
            background-color: rgba(245, 101, 101, 0.1);
            color: var(--danger-color);
        }

        /* Profile Form Styles */
        .profile-form {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }
        
        .form-control:disabled {
            background-color: #f1f5f9;
            cursor: not-allowed;
        }
        
        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }
        
        .profile-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .profile-summary {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--text-light);
            margin: 0 auto 15px;
        }
        
        .subtitle {
            color: var(--text-light);
            margin-bottom: 25px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Campus Connect</h2>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" style="position: relative; overflow: hidden;">
                    <img id="sidebar-profile-image" src="" alt="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                    <i id="sidebar-profile-icon" class="fas fa-user"></i>
                </div>
                <div>
                    <div class="user-name">John Doe</div>
                    <div class="user-role">Student</div>
                </div>
                <div style="margin-left: auto; cursor: pointer;" onclick="navigateToSection('profile')" title="Edit Profile">
                    <i class="fas fa-edit"></i>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="dashboard">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-section="internships">
                    <i class="fas fa-laptop-code"></i>
                    <span>Internship Offers</span>
                </div>
                <div class="menu-item" data-section="applications">
                    <i class="fas fa-clipboard-list"></i>
                    <span>My Applications</span>
                </div>
                <div class="menu-item" data-section="career-counseling">
                    <i class="fas fa-comments"></i>
                    <span>Career Counselling</span>
                    <span id="unread-messages-badge" class="unread-badge" style="background-color: var(--danger-color); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; margin-left: auto; display: none;">0</span>
                </div>
                <div class="menu-item" data-section="profile" id="profile-menu-item">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </div>
                <div class="menu-item" data-section="coming-soon" data-title="Settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
            
            <a href="#" id="logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div class="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
                
                <h1>Student Dashboard</h1>
                
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="user-avatar" style="width: 35px; height: 35px; cursor: pointer; position: relative; overflow: hidden;" onclick="navigateToSection('profile')" title="My Profile">
                        <img id="topbar-profile-image" src="" alt="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <i id="topbar-profile-icon" class="fas fa-user"></i>
                    </div>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="content-section">
                    <h2 class="content-title">Welcome to Your Dashboard</h2>
                    <p class="subtitle">Track your applications and explore internship opportunities.</p>
                    
                    <div class="dashboard-cards">
                        <div class="dashboard-card card-applications">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Total Applications</div>
                                    <div class="card-value" id="total-applications">0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                            </div>
                            <button class="btn btn-outline" onclick="navigateToSection('applications')">View All Applications</button>
                        </div>
                        
                        <div class="dashboard-card card-pending">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Pending</div>
                                    <div class="card-value" id="pending-applications">0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card card-approved">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Approved</div>
                                    <div class="card-value" id="approved-applications">0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card card-rejected">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Rejected</div>
                                    <div class="card-value" id="rejected-applications">0</div>
                                </div>
                                <div class="card-icon">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-internships">
                        <div class="section-header">
                            <h3>Recent Internship Offers</h3>
                            <button class="btn btn-outline" onclick="navigateToSection('internships')">View All</button>
                        </div>
                        <div id="recent-internships-list">
                            <!-- Recent internships will be loaded here -->
                            <div class="empty-state">
                                <i class="fas fa-laptop-code"></i>
                                <p>Loading recent internships...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Internship Offers Content -->
                <div id="internship-offers-content" class="content-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="content-title">Internship Offers</h2>
                        <div class="filters">
                            <input type="text" id="internship-search" placeholder="Search internships...">
                            <select id="internship-filter">
                                <option value="">All Categories</option>
                                <option value="recent">Most Recent</option>
                                <option value="stipend">Highest Stipend</option>
                                <option value="remote">Remote</option>
                                <option value="onsite">On-site</option>
                            </select>
                        </div>
                    </div>
                    <div id="internships-list" class="internship-offers">
                        <!-- Internship cards will be dynamically inserted here -->
                        <div class="empty-state">
                            <i class="fas fa-laptop-code"></i>
                            <p>Loading internships...</p>
                        </div>
                    </div>
                </div>
                
                <!-- My Applications Content -->
                <div id="my-applications-content" class="content-section" style="display: none;">
                    <h2 class="content-title">My Applications</h2>
                    <p class="subtitle">Track all your internship applications here.</p>
                    <div id="applications-list">
                        <!-- Applications will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>Loading your applications...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Career Counseling Content -->
                <div id="career-counselling-content" class="content-section" style="display: none;">
                    <h2 class="content-title">Career Counselling</h2>
                    <p class="subtitle">Get guidance from our expert faculty members</p>
                    
                    <div class="faculty-chat-container" style="display: flex; gap: 20px; margin-top: 20px;">
                        <div id="faculty-list" class="faculty-list" style="flex: 1; max-width: 450px;">
                            <!-- Faculty members will be dynamically inserted here -->
                            <div class="empty-state">
                                <i class="fas fa-users"></i>
                                <p>Loading faculty members...</p>
                            </div>
                        </div>
                        
                        <div id="chat-area" style="flex: 2; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; background-color: #f8fafc; height: 500px; display: none; flex-direction: column;">
                            <h3 id="chat-with-faculty" style="margin-top: 0; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0;">Chat with Faculty</h3>
                            <div id="chat-history" class="chat-history" style="flex: 1; overflow-y: auto; padding: 10px; background-color: white; border-radius: 8px; margin-bottom: 15px;"></div>
                            <div class="chat-input" style="display: flex; gap: 10px;">
                                <input type="text" id="message-input" placeholder="Type your message..." style="flex: 1; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                                <button class="btn btn-primary" id="send-message-btn" style="white-space: nowrap;">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Content -->
                <div id="profile-content" class="content-section" style="display: none;">
                    <h2 class="content-title">My Profile</h2>
                    <p class="subtitle">Manage your personal information and preferences</p>
                    
                    <div class="profile-summary">
                        <div style="text-align: center;">
                            <div id="profile-avatar-container" style="position: relative; width: 120px; height: 120px; border-radius: 60px; background-color: #f1f5f9; display: flex; justify-content: center; align-items: center; margin: 0 auto 15px; overflow: hidden; cursor: pointer;">
                                <img id="profile-image" src="" alt="" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                                <i id="profile-icon" class="fas fa-user" style="font-size: 3rem; color: #94a3b8;"></i>
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; background-color: rgba(0,0,0,0.5); color: white; padding: 5px; font-size: 0.8rem; opacity: 0; transition: opacity 0.2s; text-align: center;">
                                    <i class="fas fa-camera"></i> Change Photo
                                </div>
                                <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                            </div>
                            <h3 id="profile-name">John Doe</h3>
                            <p id="profile-email">john.doe@example.com</p>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; justify-content: center;">
                            <div style="margin-bottom: 10px;">
                                <small style="color: var(--text-light);">Department</small>
                                <p id="profile-department">Computer Science</p>
                            </div>
                            <div>
                                <small style="color: var(--text-light);">Profile Completion</small>
                                <div style="height: 8px; background-color: #e2e8f0; border-radius: 4px; margin-top: 5px;">
                                    <div id="profile-completion" style="height: 100%; width: 70%; background-color: var(--success-color); border-radius: 4px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" class="form-control">
                            </div>
                            
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" class="form-control">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" class="form-control" disabled>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="text" id="phone" class="form-control">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="department">Department</label>
                            <input type="text" id="department" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="skills">Skills (comma separated)</label>
                            <textarea id="skills" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <!-- New Skills Visual Section -->
                        <div class="form-section" style="margin-top: 15px;">
                            <h3 style="margin: 0 0 15px; color: var(--primary-color);">Your Skills</h3>
                            <div id="skills-badges" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;"></div>
                            
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <input type="text" id="skill-input" class="form-control" placeholder="Add a new skill">
                                <button id="add-skill-btn" class="btn btn-primary" style="white-space: nowrap;">Add Skill</button>
                            </div>
                            
                            <div style="background-color: #f8fafc; border-radius: var(--border-radius); padding: 15px;">
                                <h4 style="margin: 0 0 10px; font-size: 1rem;">Skills Strength</h4>
                                <div id="skills-chart" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                                    <!-- Skills strength bars will be added here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="bio">Bio</label>
                            <textarea id="bio" class="form-control" rows="4"></textarea>
                        </div>
                        
                        <!-- New Education Section -->
                        <div class="form-section">
                            <h3 style="margin: 25px 0 15px; color: var(--primary-color);">Education</h3>
                            
                            <div class="form-group">
                                <label for="university">University/College</label>
                                <input type="text" id="university" class="form-control">
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label for="degree">Degree</label>
                                    <input type="text" id="degree" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="graduation-year">Expected Graduation Year</label>
                                    <input type="number" id="graduation-year" class="form-control" min="2020" max="2030">
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label for="major">Major</label>
                                    <input type="text" id="major" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cgpa">CGPA</label>
                                    <input type="number" id="cgpa" class="form-control" step="0.01" min="0" max="10">
                                </div>
                            </div>
                        </div>
                        
                        <!-- New Resume Upload Section -->
                        <div class="form-section">
                            <h3 style="margin: 25px 0 15px; color: var(--primary-color);">Resume</h3>
                            
                            <div id="resume-status" style="background-color: #f8fafc; padding: 15px; border-radius: var(--border-radius); margin-bottom: 15px; display: none;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-file-pdf" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                                    <div>
                                        <p id="resume-filename" style="margin: 0; font-weight: 500;">resume.pdf</p>
                                        <p style="margin: 5px 0 0; font-size: 0.9rem; color: var(--text-light);">Uploaded on <span id="resume-date">01/01/2023</span></p>
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <button id="view-resume" class="btn btn-outline" style="margin-right: 10px;">View</button>
                                    <button id="remove-resume" class="btn btn-danger">Remove</button>
                                </div>
                            </div>
                            
                            <div id="resume-upload">
                                <div style="border: 2px dashed #cbd5e0; border-radius: var(--border-radius); padding: 20px; text-align: center;">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--text-light); margin-bottom: 10px;"></i>
                                    <p style="margin-bottom: 15px;">Drag & drop your resume file here or click to browse</p>
                                    <input type="file" id="resume-file" accept=".pdf,.doc,.docx" style="display: none;">
                                    <label for="resume-file" class="btn btn-primary">Upload Resume</label>
                                    <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">Accepted formats: PDF, DOC, DOCX (Max 5MB)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- New Social Media Links Section -->
                        <div class="form-section">
                            <h3 style="margin: 25px 0 15px; color: var(--primary-color);">Social Media</h3>
                            
                            <div class="form-group">
                                <label for="linkedin"><i class="fab fa-linkedin" style="margin-right: 8px; color: #0077b5;"></i>LinkedIn</label>
                                <input type="url" id="linkedin" class="form-control" placeholder="https://linkedin.com/in/yourprofile">
                            </div>
                            
                            <div class="form-group">
                                <label for="github"><i class="fab fa-github" style="margin-right: 8px; color: #333;"></i>GitHub</label>
                                <input type="url" id="github" class="form-control" placeholder="https://github.com/yourusername">
                            </div>
                            
                            <div class="form-group">
                                <label for="portfolio"><i class="fas fa-globe" style="margin-right: 8px; color: #2563eb;"></i>Personal Website/Portfolio</label>
                                <input type="url" id="portfolio" class="form-control" placeholder="https://yourportfolio.com">
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button id="reset-profile" class="btn btn-outline">Reset</button>
                            <button id="save-profile" class="btn btn-primary">Save Changes</button>
                        </div>
                    </div>
                </div>
                
                <!-- Coming Soon Content -->
                <div id="coming-soon-content" class="content-section" style="display: none;">
                    <h2 id="coming-soon-title" class="content-title">Coming Soon</h2>
                    <div class="empty-state">
                        <i class="fas fa-hourglass-half"></i>
                        <p>This feature is coming soon!</p>
                        <p>We're working hard to bring you more amazing features.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Templates -->
    <div id="internship-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div id="internship-details">
                <!-- Internship details will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Authentication check - redirect if not logged in
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM Content Loaded - Starting dashboard initialization");
            
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            const users = JSON.parse(localStorage.getItem('campusConnectUsers')) || {};
            
            // If not logged in or user doesn't exist, redirect to login
            if (isLoggedIn !== 'true' || !currentUserEmail || !users[currentUserEmail]) {
                alert('Please log in to access the student dashboard');
                window.location.href = 'login.html';
                return;
            }
            
            // Check if user is a student
            const currentUser = users[currentUserEmail];
            if (currentUser.userType !== 'student') {
                alert('You do not have permission to access the student dashboard');
                window.location.href = 'login.html';
                return;
            }
            
            // Set user information
            const fullName = `${currentUser.firstName} ${currentUser.lastName}`.trim();
            document.querySelector('.user-name').textContent = fullName || 'Student User';
            
            // Load profile image if it exists
            loadUserProfileImages(currentUser);
            
            // Store user type in localStorage for cross-page communication
            localStorage.setItem('userType', 'student');
            
            // Setup navigation
            setupNavigation();
            
            // Load dashboard data
            loadDashboardData();
            
            // Initialize chat system
            if (typeof initChat === 'function') {
                initChat();
            }
            
            // Check URL parameters for section to show
            setTimeout(() => {
                const params = new URLSearchParams(window.location.search);
                const section = params.get('section');
                
                if (section) {
                    const menuItem = document.querySelector(`.menu-item[data-section="${section}"]`);
                    if (menuItem) {
                        menuItem.click();
                    }
                }
            }, 100);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // Alt+P - Go to Profile
                if (event.altKey && event.key === 'p') {
                    event.preventDefault();
                    navigateToSection('profile');
                }
                
                // Alt+D - Go to Dashboard
                if (event.altKey && event.key === 'd') {
                    event.preventDefault();
                    navigateToSection('dashboard');
                }
                
                // Alt+I - Go to Internships
                if (event.altKey && event.key === 'i') {
                    event.preventDefault();
                    navigateToSection('internships');
                }
                
                // Alt+A - Go to Applications
                if (event.altKey && event.key === 'a') {
                    event.preventDefault();
                    navigateToSection('applications');
                }
            });
        });

        // Function to set up navigation
        function setupNavigation() {
            console.log("Setting up dashboard navigation");
            
            // Toggle sidebar on mobile
            document.querySelector('.hamburger').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('active');
            });
            
            // Menu navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    console.log("Menu item clicked:", section);
                    
                    // Remove active class from all menu items
                    document.querySelectorAll('.menu-item').forEach(menuItem => {
                        menuItem.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Hide all content sections
                    document.querySelectorAll('.content-section').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Show the appropriate content section
                    let contentId = section + '-content';
                    if (section === 'dashboard') contentId = 'dashboard-content';
                    if (section === 'career-counseling') contentId = 'career-counselling-content';
                    
                    const targetContent = document.getElementById(contentId);
                    if (targetContent) {
                        console.log("Showing content section:", contentId);
                        targetContent.style.display = 'block';
                        
                        // Display the title for coming soon sections
                        if (section === 'coming-soon') {
                            const title = this.getAttribute('data-title') || 'Coming Soon';
                            const titleElem = document.getElementById('coming-soon-title');
                            if (titleElem) {
                                titleElem.textContent = title;
                            }
                        }
                        
                        // Load section-specific data
                        if (section === 'internships') {
                            loadInternshipOffers();
                        } else if (section === 'applications') {
                            loadStudentApplications();
                        } else if (section === 'career-counseling') {
                            // Force refresh faculty data from localStorage first
                            if (typeof refreshFacultyData === 'function') {
                                refreshFacultyData();
                            } else {
                                loadFacultyMembers();
                            }
                        } else if (section === 'profile') {
                            loadProfileData();
                        }
                    } else {
                        console.error("Content section not found:", contentId);
                    }
                });
            });
            
            // Setup internship search and filter
            const internshipSearch = document.getElementById('internship-search');
            const internshipFilter = document.getElementById('internship-filter');
            
            if (internshipSearch) {
                internshipSearch.addEventListener('input', function() {
                    filterInternships(this.value, internshipFilter.value);
                });
            }
            
            if (internshipFilter) {
                internshipFilter.addEventListener('change', function() {
                    filterInternships(internshipSearch.value, this.value);
                });
            }
            
            // Setup logout functionality
            const logoutButton = document.getElementById('logout');
            if (logoutButton) {
                logoutButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Log out from chat socket
                    if (window.chatSocket) {
                        chatSocket.logout();
                    }
                    
                    // Clear login status
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('currentUserEmail');
                    localStorage.removeItem('userRole');
                    
                    // Redirect to login page
                    window.location.href = 'login.html';
                });
            }
        }

        // Function to navigate to a specific section
        function navigateToSection(section) {
            console.log("Navigating to section:", section);
            const menuItem = document.querySelector(`.menu-item[data-section="${section}"]`);
            if (menuItem) {
                menuItem.click();
            } else {
                console.error("Menu item not found for section:", section);
            }
        }

        // Force refreshing faculty data when needed
        function refreshFacultyData() {
            console.log("Force refreshing faculty data from localStorage");
            // This ensures we load the latest data from localStorage
            if (typeof loadFacultyMembers === 'function') {
                loadFacultyMembers();
            }
        }

        // Function to load dashboard data
        function loadDashboardData() {
            console.log("Loading dashboard data");
            
            // Get current user email
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            if (!currentUserEmail) return;
            
            try {
                // Load application statistics
                const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
                const userApplications = applications.filter(app => app.studentEmail === currentUserEmail);
                
                const totalApplications = userApplications.length;
                const pendingApplications = userApplications.filter(app => app.status === 'pending').length;
                const approvedApplications = userApplications.filter(app => app.status === 'accepted').length;
                const rejectedApplications = userApplications.filter(app => app.status === 'rejected').length;
                
                // Update dashboard statistics
                document.getElementById('total-applications').textContent = totalApplications;
                document.getElementById('pending-applications').textContent = pendingApplications;
                document.getElementById('approved-applications').textContent = approvedApplications;
                document.getElementById('rejected-applications').textContent = rejectedApplications;
                
                // Load recent internships
                loadRecentInternships();
                
            } catch (error) {
                console.error("Error loading dashboard data:", error);
            }
        }
        
        // Function to load recent internships
        function loadRecentInternships() {
            console.log("Loading recent internships");
            
            const recentInternshipsList = document.getElementById('recent-internships-list');
            if (!recentInternshipsList) return;
            
            try {
                // Get all active internships
                const internships = getAllActiveInternships();
                
                // Sort by posted date (most recent first) and take top 3
                internships.sort((a, b) => new Date(b.postedDate) - new Date(a.postedDate));
                const recentInternships = internships.slice(0, 3);
                
                if (recentInternships.length === 0) {
                    recentInternshipsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-laptop-code"></i>
                            <p>No internship opportunities available yet.</p>
                            <p>Check back later for new opportunities.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                recentInternships.forEach(internship => {
                    // Limit description length
                    const shortDescription = internship.description && internship.description.length > 100
                        ? internship.description.substring(0, 100) + '...'
                        : (internship.description || 'No description provided');
                    
                    html += `
                        <div class="internship-card">
                            <div class="internship-header">
                                <h3>${internship.title || 'Untitled Internship'}</h3>
                                <span class="company-badge">${internship.companyName || 'Unknown Company'}</span>
                            </div>
                            
                            <div class="internship-meta">
                                <span><i class="fas fa-map-marker-alt"></i> ${internship.location || 'Location not specified'}</span>
                                <span><i class="fas fa-clock"></i> ${internship.duration || 'Duration not specified'}</span>
                                <span><i class="fas fa-money-bill-wave"></i> ${internship.stipend || 'Stipend not specified'}</span>
                            </div>
                            
                            <p class="internship-description">${shortDescription}</p>
                            
                            <div style="text-align: right; margin-top: 10px;">
                                <button class="btn btn-outline" onclick="viewInternshipDetails('${internship.id}')">
                                    View Details
                                </button>
                                <button class="btn btn-primary" onclick="applyForInternship('${internship.id}')">
                                    Apply Now
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                recentInternshipsList.innerHTML = html;
                
            } catch (error) {
                console.error("Error loading recent internships:", error);
                recentInternshipsList.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading internships. Please try again later.</p>
                    </div>
                `;
            }
        }
        
        // Function to get all active internships
        function getAllActiveInternships() {
            const internships = JSON.parse(localStorage.getItem('campusConnectInternships')) || [];
            return internships.filter(internship => internship.status === 'active');
        }
        
        // Function to load internship offers
        function loadInternshipOffers(filteredInternships = null) {
            console.log("Loading internship offers");
            
            const internshipsList = document.getElementById('internships-list');
            if (!internshipsList) {
                console.error("Internships list container not found");
                return;
            }
            
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            
            try {
                // Get internships from function or use filtered list
                const internships = filteredInternships || getAllActiveInternships();
                console.log("Loaded internships:", internships.length);
                
                // Get student applications
                const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
                const studentApplications = applications.filter(app => app.studentEmail === currentUserEmail);
                
                // Check if internships is undefined or empty
                if (!internships || internships.length === 0) {
                    internshipsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-laptop-code"></i>
                            <p>No internship opportunities available at the moment.</p>
                            <p>Check back later for new opportunities.</p>
                        </div>
                    `;
                    return;
                }
                
                // Generate HTML for each internship
                let html = '';
                
                internships.forEach(internship => {
                    // Check if student has applied for this internship
                    const application = studentApplications.find(app => app.internshipId === internship.id);
                    const hasApplied = !!application;
                    const applicationStatus = application ? application.status : null;
                    
                    // Get status color
                    let statusColor = '#f59e0b'; // Default to warning/pending color
                    if (applicationStatus) {
                        if (applicationStatus.toLowerCase() === 'accepted') statusColor = 'var(--success-color)';
                        if (applicationStatus.toLowerCase() === 'rejected') statusColor = 'var(--danger-color)';
                    }
                    
                    // Limit description length
                    const shortDescription = internship.description && internship.description.length > 120
                        ? internship.description.substring(0, 120) + '...'
                        : (internship.description || 'No description provided');
                    
                    // Create skills HTML
                    let skillsHTML = '';
                    if (internship.skills && Array.isArray(internship.skills)) {
                        const displaySkills = internship.skills.slice(0, 3);
                        skillsHTML = displaySkills.map(skill =>
                            `<span class="skill-tag">${skill}</span>`
                        ).join('');
                        
                        if (internship.skills.length > 3) {
                            skillsHTML += `<span class="skill-tag">+${internship.skills.length - 3} more</span>`;
                        }
                    }
                    
                    html += `
                        <div class="internship-card">
                            <div class="internship-header">
                                <h3>${internship.title || 'Untitled Internship'}</h3>
                                <span class="company-badge">${internship.companyName || 'Unknown Company'}</span>
                            </div>
                            
                            <div class="internship-meta">
                                <span><i class="fas fa-map-marker-alt"></i> ${internship.location || 'Location not specified'}</span>
                                <span><i class="fas fa-clock"></i> ${internship.duration || 'Duration not specified'}</span>
                                <span><i class="fas fa-money-bill-wave"></i> ${internship.stipend || 'Stipend not specified'}</span>
                                ${applicationStatus ? `
                                    <span style="background-color: ${statusColor}; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">
                                        <i class="fas fa-clock"></i> ${applicationStatus}
                                    </span>
                                ` : ''}
                            </div>
                            
                            <p class="internship-description">${shortDescription}</p>
                            
                            <div class="skills-tags">
                                ${skillsHTML}
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-outline" onclick="viewInternshipDetails('${internship.id}')">
                                    View Details
                                </button>
                                ${!hasApplied ? `
                                    <button class="btn btn-primary" onclick="applyForInternship('${internship.id}')">
                                        Apply Now
                                    </button>
                                ` : `
                                    <button class="btn" style="background-color: ${statusColor}; color: white;" disabled>
                                        ${applicationStatus || 'Applied'}
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
                });
                
                internshipsList.innerHTML = html;
                
            } catch (error) {
                console.error("Error loading internships:", error);
                internshipsList.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading internships. Please try again later.</p>
                        <p>Error details: ${error.message}</p>
                        <button class="btn btn-primary" onclick="loadInternshipOffers()">
                            Retry
                        </button>
                    </div>
                `;
            }
        }
        
        // Function to filter internships
        function filterInternships(searchTerm, filterType) {
            searchTerm = searchTerm.toLowerCase().trim();
            
            const allInternships = getAllActiveInternships();
            let filteredInternships = [...allInternships];
            
            // Apply search term filter
            if (searchTerm) {
                filteredInternships = filteredInternships.filter(internship => {
                    return (
                        (internship.title && internship.title.toLowerCase().includes(searchTerm)) ||
                        (internship.companyName && internship.companyName.toLowerCase().includes(searchTerm)) ||
                        (internship.description && internship.description.toLowerCase().includes(searchTerm)) ||
                        (internship.skills && Array.isArray(internship.skills) &&
                            internship.skills.some(skill => skill.toLowerCase().includes(searchTerm)))
                    );
                });
            }
            
            // Apply category filter
            if (filterType) {
                switch (filterType) {
                    case 'recent':
                        filteredInternships.sort((a, b) => new Date(b.postedDate) - new Date(a.postedDate));
                        break;
                    case 'stipend':
                        filteredInternships.sort((a, b) => {
                            const getStipendValue = (stipend) => {
                                if (!stipend || typeof stipend !== 'string') return 0;
                                const match = stipend.match(/\d+/g);
                                return match ? parseInt(match[0]) : 0;
                            };
                            return getStipendValue(b.stipend) - getStipendValue(a.stipend);
                        });
                        break;
                    case 'remote':
                        filteredInternships = filteredInternships.filter(i =>
                            i.workArrangement === 'Remote' ||
                            (i.location && i.location.toLowerCase().includes('remote')));
                        break;
                    case 'onsite':
                        filteredInternships = filteredInternships.filter(i =>
                            i.workArrangement === 'On-site' ||
                            i.workArrangement === 'Hybrid' ||
                            (i.location && (i.location.toLowerCase().includes('onsite') ||
                                i.location.toLowerCase().includes('on-site') ||
                                i.location.toLowerCase().includes('in-office'))));
                        break;
                }
            }
            
            // Load the filtered internships
            loadInternshipOffers(filteredInternships);
        }

        // Function to view internship details
        function viewInternshipDetails(internshipId) {
            console.log("Viewing internship details for ID:", internshipId);
            
            // Get internship details
            const internships = JSON.parse(localStorage.getItem('campusConnectInternships')) || [];
            const internship = internships.find(item => item.id === internshipId);
            
            if (!internship) {
                alert('Error: Could not find internship details');
                return;
            }
            
            // Format deadline
            let deadlineDisplay = 'No deadline';
            if (internship.applicationDeadline) {
                const deadlineDate = new Date(internship.applicationDeadline);
                deadlineDisplay = isNaN(deadlineDate) ? internship.applicationDeadline : deadlineDate.toLocaleDateString();
            }
            
            // Format requirements as list
            let requirementsHTML = '<ul style="padding-left: 20px; margin-bottom: 20px;">';
            if (internship.requirements && internship.requirements.length > 0) {
                if (Array.isArray(internship.requirements)) {
                    internship.requirements.forEach(req => {
                        if (req && typeof req === 'string') {
                            requirementsHTML += `<li style="margin-bottom: 5px;">${req}</li>`;
                        }
                    });
                } else if (typeof internship.requirements === 'string') {
                    requirementsHTML += `<li style="margin-bottom: 5px;">${internship.requirements}</li>`;
                }
            } else {
                requirementsHTML += '<li>No specific requirements</li>';
            }
            requirementsHTML += '</ul>';
            
            // Format skills as tags
            let skillsHTML = '';
            if (internship.skills && internship.skills.length > 0) {
                if (Array.isArray(internship.skills)) {
                    internship.skills.forEach(skill => {
                        if (skill && typeof skill === 'string') {
                            skillsHTML += `<span class="skill-tag">${skill}</span>`;
                        }
                    });
                } else if (typeof internship.skills === 'string') {
                    skillsHTML += `<span class="skill-tag">${internship.skills}</span>`;
                }
            }
            
            // Check if student has already applied
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
            const hasApplied = applications.some(app => 
                app.internshipId === internshipId && app.studentEmail === currentUserEmail
            );
            
            const applicationBtn = hasApplied 
                ? `<button class="btn" style="background-color: #e2e8f0; color: var(--text-color); opacity: 0.7;" disabled>
                    Already Applied
                   </button>`
                : `<button onclick="applyForInternship('${internship.id}')" class="btn btn-success" style="margin-right: 15px;">
                    Apply for this Internship
                   </button>`;
            
            // Get modal and show it
            const modal = document.getElementById('internship-modal');
            const modalContent = modal.querySelector('#internship-details');
            
            modalContent.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: var(--primary-color); margin-bottom: 5px;">${internship.title || 'Untitled Internship'}</h2>
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span class="company-badge">${internship.companyName || 'Unknown Company'}</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center;">
                            <i class="fas fa-map-marker-alt" style="margin-right: 10px; color: var(--text-light);"></i>
                            <span>${internship.location || 'Location not specified'}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center;">
                            <i class="fas fa-clock" style="margin-right: 10px; color: var(--text-light);"></i>
                            <span>${internship.duration || 'Duration not specified'}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center;">
                            <i class="fas fa-money-bill-alt" style="margin-right: 10px; color: var(--text-light);"></i>
                            <span>${internship.stipend || 'Stipend not specified'}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center;">
                            <i class="fas fa-calendar-alt" style="margin-right: 10px; color: var(--text-light);"></i>
                            <span>Deadline: ${deadlineDisplay}</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 10px; color: var(--text-color);">About the Internship</h3>
                    <p style="line-height: 1.6;">${internship.description || 'No description provided.'}</p>
                </div>
                
                ${internship.responsibilities ? `
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 10px; color: var(--text-color);">Responsibilities</h3>
                    <p style="line-height: 1.6;">${internship.responsibilities}</p>
                </div>
                ` : ''}
                
                ${internship.learningOutcomes ? `
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 10px; color: var(--text-color);">Learning Outcomes</h3>
                    <p style="line-height: 1.6;">${internship.learningOutcomes}</p>
                </div>
                ` : ''}
                
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 10px; color: var(--text-color);">Requirements</h3>
                    ${requirementsHTML}
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 10px; color: var(--text-color);">Skills Required</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${skillsHTML}
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    ${applicationBtn}
                    
                    <button onclick="closeInternshipModal()" class="btn btn-outline">
                        Close
                    </button>
                </div>
            `;
            
            // Show modal
            modal.style.display = 'flex';
            
            // Setup close button
            const closeBtn = modal.querySelector('.close-btn');
            closeBtn.onclick = closeInternshipModal;
        }
        
        // Function to close internship modal
        function closeInternshipModal() {
            const modal = document.getElementById('internship-modal');
            modal.style.display = 'none';
        }
        
        // Function to apply for an internship
        function applyForInternship(internshipId) {
            console.log("Applying for internship ID:", internshipId);
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            
            if (!currentUserEmail) {
                alert('Please log in to apply for internships');
                return;
            }
            
            try {
                // Get user data
                const users = JSON.parse(localStorage.getItem('campusConnectUsers')) || {};
                const currentUser = users[currentUserEmail];
                
                if (!currentUser) {
                    alert('User data not found. Please log in again.');
                    return;
                }
                
                // Check if profile is sufficiently complete
                if (!currentUser.firstName || !currentUser.lastName || !currentUser.phone) {
                    if (confirm('Your profile is incomplete. Complete your profile to increase your chances. Go to profile now?')) {
                        closeInternshipModal();
                        navigateToSection('profile');
                        return;
                    }
                }
                
                // Check if already applied
                const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
                const existingApplication = applications.find(app => 
                    app.internshipId === internshipId && app.studentEmail === currentUserEmail
                );
                
                if (existingApplication) {
                    alert('You have already applied for this internship');
                    return;
                }
                
                // Get internship details
                const internships = JSON.parse(localStorage.getItem('campusConnectInternships')) || [];
                const internship = internships.find(item => item.id === internshipId);
                
                if (!internship) {
                    alert('Internship not found');
                    return;
                }
                
                // Create application object
                const application = {
                    id: 'app_' + Date.now(),
                    internshipId: internshipId,
                    studentEmail: currentUserEmail,
                    studentName: `${currentUser.firstName} ${currentUser.lastName}`.trim(),
                    companyEmail: internship.companyEmail,
                    appliedDate: new Date().toISOString(),
                    status: 'pending',
                    internshipTitle: internship.title,
                    companyName: internship.companyName
                };
                
                // Save application
                applications.push(application);
                localStorage.setItem('campusConnectApplications', JSON.stringify(applications));
                
                // Update internship applicants list
                const internshipIndex = internships.findIndex(item => item.id === internshipId);
                if (internshipIndex !== -1) {
                    if (!internships[internshipIndex].applicants) {
                        internships[internshipIndex].applicants = [];
                    }
                    
                    if (!internships[internshipIndex].applicants.includes(currentUserEmail)) {
                        internships[internshipIndex].applicants.push(currentUserEmail);
                        localStorage.setItem('campusConnectInternships', JSON.stringify(internships));
                    }
                }
                
                // Show success message
                alert('Application submitted successfully!');
                
                // Close modal if open
                closeInternshipModal();
                
                // Refresh the dashboard
                loadDashboardData();
                
                // Refresh internship offers if visible
                if (document.getElementById('internship-offers-content').style.display !== 'none') {
                    loadInternshipOffers();
                }
                
            } catch (error) {
                console.error('Error applying for internship:', error);
                alert(`Error: ${error.message}`);
            }
        }
        
        // Function to load student applications
        function loadStudentApplications() {
            console.log("Loading student applications...");
            
            const applicationsList = document.getElementById('applications-list');
            if (!applicationsList) {
                console.error("Applications content section not found");
                return;
            }
            
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            if (!currentUserEmail) {
                applicationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>You need to be logged in to view your applications.</p>
                    </div>
                `;
                return;
            }
            
            try {
                // Get user applications
                const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
                const userApplications = applications.filter(app => app.studentEmail === currentUserEmail);
                
                console.log("Found applications:", userApplications.length);
                
                // Display applications or empty state
                if (userApplications.length === 0) {
                    applicationsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <p>You haven't applied to any internships yet.</p>
                            <button onclick="navigateToSection('internships')" class="btn btn-primary" style="margin-top: 20px;">
                                Browse Available Internships
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Create HTML content for applications
                let html = `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">`;
                
                // Get internships details for each application
                const internships = JSON.parse(localStorage.getItem('campusConnectInternships')) || [];
                
                userApplications.forEach(application => {
                    const internship = internships.find(i => i.id === application.internshipId) || {};
                    
                    // Get status color
                    let statusColor = '#f59e0b'; // Default to warning/pending color
                    let statusIcon = 'clock';
                    
                    if (application.status) {
                        if (application.status.toLowerCase() === 'accepted') {
                            statusColor = 'var(--success-color)';
                            statusIcon = 'check-circle';
                        } else if (application.status.toLowerCase() === 'rejected') {
                            statusColor = 'var(--danger-color)';
                            statusIcon = 'times-circle';
                        }
                    }
                    
                    const applicationDate = new Date(application.appliedDate).toLocaleDateString();
                    
                    html += `
                        <div class="application-card" style="border-left-color: ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <h3 style="margin: 0; color: var(--primary-color);">${internship.title || application.internshipTitle || 'Unknown Position'}</h3>
                                <span style="background-color: ${statusColor}; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">
                                    <i class="fas fa-${statusIcon}"></i> ${application.status || 'Pending'}
                                </span>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-building" style="width: 16px; color: var(--text-light);"></i>
                                    <span>${internship.companyName || application.companyName || 'Unknown Company'}</span>
                                </div>
                                
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-calendar-alt" style="width: 16px; color: var(--text-light);"></i>
                                    <span>Applied on: ${applicationDate}</span>
                                </div>
                                
                                ${internship.location ? `
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-map-marker-alt" style="width: 16px; color: var(--text-light);"></i>
                                    <span>${internship.location}</span>
                                </div>
                                ` : ''}
                                
                                ${internship.stipend ? `
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-money-bill-wave" style="width: 16px; color: var(--text-light);"></i>
                                    <span>${internship.stipend}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                
                applicationsList.innerHTML = html;
                
            } catch (error) {
                console.error("Error loading student applications:", error);
                applicationsList.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading applications. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Function to load user profile data
        function loadProfileData() {
            console.log("Loading profile data");
            
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            if (!currentUserEmail) return;
            
            try {
                // Get user data
                const users = JSON.parse(localStorage.getItem('campusConnectUsers')) || {};
                const currentUser = users[currentUserEmail];
                
                if (!currentUser) {
                    alert('User data not found. Please log in again.');
                    return;
                }
                
                // Update profile summary
                const fullName = `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim() || 'Student User';
                document.getElementById('profile-name').textContent = fullName;
                document.getElementById('profile-email').textContent = currentUser.email || 'No email provided';
                document.getElementById('profile-department').textContent = currentUser.department || 'Not specified';
                
                // Load profile image if it exists
                const profileImage = document.getElementById('profile-image');
                const profileIcon = document.getElementById('profile-icon');
                
                if (currentUser.profileImage) {
                    // Update profile page avatar
                    profileImage.src = currentUser.profileImage;
                    profileImage.style.display = 'block';
                    profileIcon.style.display = 'none';
                } else {
                    // Reset profile page avatar
                    profileImage.style.display = 'none';
                    profileIcon.style.display = 'block';
                }
                
                // Update all user profile images
                loadUserProfileImages(currentUser);
                
                // Setup profile image upload
                const profileAvatarContainer = document.getElementById('profile-avatar-container');
                const profileUpload = document.getElementById('profile-upload');
                
                if (profileAvatarContainer && profileUpload) {
                    // Show overlay on hover
                    profileAvatarContainer.addEventListener('mouseover', function() {
                        profileAvatarContainer.querySelector('div').style.opacity = '1';
                    });
                    
                    profileAvatarContainer.addEventListener('mouseout', function() {
                        profileAvatarContainer.querySelector('div').style.opacity = '0';
                    });
                    
                    // Trigger file input on click
                    profileAvatarContainer.addEventListener('click', function() {
                        profileUpload.click();
                    });
                    
                    // Handle file selection
                    const newProfileUpload = profileUpload.cloneNode(true);
                    profileUpload.parentNode.replaceChild(newProfileUpload, profileUpload);
                    
                    newProfileUpload.addEventListener('change', function(e) {
                        if (e.target.files.length > 0) {
                            const file = e.target.files[0];
                            
                            // Check file type
                            if (!file.type.match('image.*')) {
                                alert('Please select an image file.');
                                return;
                            }
                            
                            // Check file size (max 2MB)
                            if (file.size > 2 * 1024 * 1024) {
                                alert('Image file size should not exceed 2MB.');
                                return;
                            }
                            
                            // Read and display the image
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                // Store image in user data
                                currentUser.profileImage = event.target.result;
                                
                                // Save to localStorage
                                users[currentUserEmail] = currentUser;
                                localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                                
                                // Update profile display
                                profileImage.src = event.target.result;
                                profileImage.style.display = 'block';
                                profileIcon.style.display = 'none';
                                
                                // Update all user profile images
                                loadUserProfileImages(currentUser);
                                
                                // Recalculate profile completion
                                loadProfileData();
                            };
                            
                            reader.readAsDataURL(file);
                        }
                    });
                }
                
                // Calculate profile completion percentage
                const requiredFields = [
                    'firstName', 'lastName', 'phone', 'department', 'skills', 'bio',
                    'university', 'degree', 'graduationYear', 'major', 'cgpa',
                    'linkedin', 'github', 'portfolio', 'resumeFile', 'profileImage'
                ];
                let completedFields = 0;
                
                requiredFields.forEach(field => {
                    if (currentUser[field] && 
                        ((typeof currentUser[field] === 'string' && currentUser[field].trim() !== '') || 
                         (Array.isArray(currentUser[field]) && currentUser[field].length > 0))) {
                        completedFields++;
                    }
                });
                
                const completionPercentage = Math.round((completedFields / requiredFields.length) * 100);
                document.getElementById('profile-completion').style.width = `${completionPercentage}%`;
                
                // Fill in profile form
                document.getElementById('firstName').value = currentUser.firstName || '';
                document.getElementById('lastName').value = currentUser.lastName || '';
                document.getElementById('email').value = currentUser.email || '';
                document.getElementById('phone').value = currentUser.phone || '';
                document.getElementById('department').value = currentUser.department || '';
                document.getElementById('skills').value = Array.isArray(currentUser.skills) ? currentUser.skills.join(', ') : (currentUser.skills || '');
                document.getElementById('bio').value = currentUser.bio || '';
                
                // Display skills badges and chart
                renderSkillsBadges(currentUser);
                
                // Fill education details
                document.getElementById('university').value = currentUser.university || '';
                document.getElementById('degree').value = currentUser.degree || '';
                document.getElementById('graduation-year').value = currentUser.graduationYear || '';
                document.getElementById('major').value = currentUser.major || '';
                document.getElementById('cgpa').value = currentUser.cgpa || '';
                
                // Fill social media details
                document.getElementById('linkedin').value = currentUser.linkedin || '';
                document.getElementById('github').value = currentUser.github || '';
                document.getElementById('portfolio').value = currentUser.portfolio || '';
                
                // Handle resume display
                if (currentUser.resumeFile) {
                    document.getElementById('resume-status').style.display = 'block';
                    document.getElementById('resume-filename').textContent = currentUser.resumeFileName || 'resume.pdf';
                    document.getElementById('resume-date').textContent = currentUser.resumeUploadDate || new Date().toLocaleDateString();
                    document.getElementById('resume-upload').style.display = 'none';
                } else {
                    document.getElementById('resume-status').style.display = 'none';
                    document.getElementById('resume-upload').style.display = 'block';
                }
                
                // Setup form buttons
                const saveProfileBtn = document.getElementById('save-profile');
                if (saveProfileBtn) {
                    // Remove existing event listeners
                    const newSaveBtn = saveProfileBtn.cloneNode(true);
                    saveProfileBtn.parentNode.replaceChild(newSaveBtn, saveProfileBtn);
                    newSaveBtn.addEventListener('click', saveProfileData);
                }
                
                const resetProfileBtn = document.getElementById('reset-profile');
                if (resetProfileBtn) {
                    // Remove existing event listeners
                    const newResetBtn = resetProfileBtn.cloneNode(true);
                    resetProfileBtn.parentNode.replaceChild(newResetBtn, resetProfileBtn);
                    newResetBtn.addEventListener('click', loadProfileData);
                }
                
                // Setup resume buttons
                const viewResumeBtn = document.getElementById('view-resume');
                if (viewResumeBtn) {
                    const newViewBtn = viewResumeBtn.cloneNode(true);
                    viewResumeBtn.parentNode.replaceChild(newViewBtn, viewResumeBtn);
                    newViewBtn.addEventListener('click', function() {
                        // In a real app, this would open the actual file
                        alert('In a production environment, this would open your resume file.');
                    });
                }
                
                const removeResumeBtn = document.getElementById('remove-resume');
                if (removeResumeBtn) {
                    const newRemoveBtn = removeResumeBtn.cloneNode(true);
                    removeResumeBtn.parentNode.replaceChild(newRemoveBtn, removeResumeBtn);
                    newRemoveBtn.addEventListener('click', function() {
                        if (confirm('Are you sure you want to remove your resume?')) {
                            delete currentUser.resumeFile;
                            delete currentUser.resumeFileName;
                            delete currentUser.resumeUploadDate;
                            users[currentUserEmail] = currentUser;
                            localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                            document.getElementById('resume-status').style.display = 'none';
                            document.getElementById('resume-upload').style.display = 'block';
                        }
                    });
                }
                
                // Setup resume upload
                const resumeFileInput = document.getElementById('resume-file');
                if (resumeFileInput) {
                    const newFileInput = resumeFileInput.cloneNode(true);
                    resumeFileInput.parentNode.replaceChild(newFileInput, resumeFileInput);
                    newFileInput.addEventListener('change', function(e) {
                        if (e.target.files.length > 0) {
                            const file = e.target.files[0];
                            
                            // Check file size (max 5MB)
                            if (file.size > 5 * 1024 * 1024) {
                                alert('File size exceeds 5MB limit. Please choose a smaller file.');
                                return;
                            }
                            
                            // In a real app, we would upload the file to a server
                            // For this demo, we'll simulate file storage in localStorage
                            // In practice, you should never store files in localStorage
                            
                            // Convert file to base64 string to simulate storage
                            // Note: This is not a good practice for production
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                currentUser.resumeFile = 'file_uploaded'; // In real app, this would be a file URL or ID
                                currentUser.resumeFileName = file.name;
                                currentUser.resumeUploadDate = new Date().toLocaleDateString();
                                
                                users[currentUserEmail] = currentUser;
                                localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                                
                                // Update UI
                                document.getElementById('resume-status').style.display = 'block';
                                document.getElementById('resume-filename').textContent = file.name;
                                document.getElementById('resume-date').textContent = new Date().toLocaleDateString();
                                document.getElementById('resume-upload').style.display = 'none';
                                
                                // Recalculate profile completion
                                loadProfileData();
                            };
                            
                            // Read file as data URL
                            reader.readAsDataURL(file);
                        }
                    });
                }
                
                // Setup drag and drop for resume upload
                const dropArea = document.querySelector('#resume-upload > div');
                if (dropArea) {
                    // Prevent default behavior for all drag events
                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        dropArea.addEventListener(eventName, preventDefaults, false);
                    });
                    
                    function preventDefaults(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    
                    // Add highlight class when dragging over
                    ['dragenter', 'dragover'].forEach(eventName => {
                        dropArea.addEventListener(eventName, highlight, false);
                    });
                    
                    ['dragleave', 'drop'].forEach(eventName => {
                        dropArea.addEventListener(eventName, unhighlight, false);
                    });
                    
                    function highlight() {
                        dropArea.style.borderColor = 'var(--primary-color)';
                        dropArea.style.backgroundColor = 'rgba(37, 99, 235, 0.05)';
                    }
                    
                    function unhighlight() {
                        dropArea.style.borderColor = '#cbd5e0';
                        dropArea.style.backgroundColor = 'transparent';
                    }
                    
                    // Handle dropped files
                    dropArea.addEventListener('drop', handleDrop, false);
                    
                    function handleDrop(e) {
                        const dt = e.dataTransfer;
                        const files = dt.files;
                        
                        if (files.length > 0) {
                            const file = files[0];
                            
                            // Check file type
                            const fileType = file.type;
                            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                            
                            if (!validTypes.includes(fileType)) {
                                alert('Invalid file type. Please upload a PDF, DOC, or DOCX file.');
                                return;
                            }
                            
                            // Check file size (max 5MB)
                            if (file.size > 5 * 1024 * 1024) {
                                alert('File size exceeds 5MB limit. Please choose a smaller file.');
                                return;
                            }
                            
                            // Handle the file (same as file input change handler)
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                currentUser.resumeFile = 'file_uploaded'; // In real app, this would be a file URL or ID
                                currentUser.resumeFileName = file.name;
                                currentUser.resumeUploadDate = new Date().toLocaleDateString();
                                
                                users[currentUserEmail] = currentUser;
                                localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                                
                                // Update UI
                                document.getElementById('resume-status').style.display = 'block';
                                document.getElementById('resume-filename').textContent = file.name;
                                document.getElementById('resume-date').textContent = new Date().toLocaleDateString();
                                document.getElementById('resume-upload').style.display = 'none';
                                
                                // Recalculate profile completion
                                loadProfileData();
                            };
                            
                            // Read file as data URL
                            reader.readAsDataURL(file);
                        }
                    }
                }
                
                // Setup add skill button
                const addSkillBtn = document.getElementById('add-skill-btn');
                const skillInput = document.getElementById('skill-input');
                
                if (addSkillBtn && skillInput) {
                    const newAddSkillBtn = addSkillBtn.cloneNode(true);
                    addSkillBtn.parentNode.replaceChild(newAddSkillBtn, addSkillBtn);
                    
                    newAddSkillBtn.addEventListener('click', function() {
                        const newSkill = skillInput.value.trim();
                        
                        if (!newSkill) {
                            return;
                        }
                        
                        // Get current skills
                        if (!Array.isArray(currentUser.skills)) {
                            currentUser.skills = [];
                        }
                        
                        // Check if skill already exists
                        if (currentUser.skills.includes(newSkill)) {
                            alert('This skill is already in your profile.');
                            return;
                        }
                        
                        // Add new skill
                        currentUser.skills.push(newSkill);
                        
                        // Create skill strength entry if it doesn't exist
                        if (!currentUser.skillStrengths) {
                            currentUser.skillStrengths = {};
                        }
                        
                        // Set default strength for new skill (7 out of 10)
                        currentUser.skillStrengths[newSkill] = 7;
                        
                        // Save to localStorage
                        users[currentUserEmail] = currentUser;
                        localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                        
                        // Update skills textarea
                        document.getElementById('skills').value = currentUser.skills.join(', ');
                        
                        // Render badges
                        renderSkillsBadges(currentUser);
                        
                        // Clear input
                        skillInput.value = '';
                        
                        // Recalculate profile completion
                        loadProfileData();
                    });
                    
                    // Add enter key support
                    skillInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            newAddSkillBtn.click();
                        }
                    });
                }
                
            } catch (error) {
                console.error("Error loading profile data:", error);
                alert(`Error loading profile data: ${error.message}`);
            }
        }
        
        // Function to save profile data
        function saveProfileData() {
            console.log("Saving profile data");
            
            const currentUserEmail = localStorage.getItem('currentUserEmail');
            if (!currentUserEmail) {
                alert('Please log in to save your profile.');
                return;
            }
            
            try {
                // Get user data
                const users = JSON.parse(localStorage.getItem('campusConnectUsers')) || {};
                const currentUser = users[currentUserEmail];
                
                if (!currentUser) {
                    alert('User data not found. Please log in again.');
                    return;
                }
                
                // Get form values
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const department = document.getElementById('department').value.trim();
                const skillsStr = document.getElementById('skills').value.trim();
                const bio = document.getElementById('bio').value.trim();
                
                // Get education details
                const university = document.getElementById('university').value.trim();
                const degree = document.getElementById('degree').value.trim();
                const graduationYear = document.getElementById('graduation-year').value.trim();
                const major = document.getElementById('major').value.trim();
                const cgpa = document.getElementById('cgpa').value.trim();
                
                // Get social media details
                const linkedin = document.getElementById('linkedin').value.trim();
                const github = document.getElementById('github').value.trim();
                const portfolio = document.getElementById('portfolio').value.trim();
                
                // Validation
                if (!firstName || !lastName) {
                    alert('Please enter your first and last name.');
                    return;
                }
                
                // Update user data
                currentUser.firstName = firstName;
                currentUser.lastName = lastName;
                currentUser.phone = phone;
                currentUser.department = department;
                currentUser.bio = bio;
                
                // Update education details
                currentUser.university = university;
                currentUser.degree = degree;
                currentUser.graduationYear = graduationYear;
                currentUser.major = major;
                currentUser.cgpa = cgpa;
                
                // Update social media details
                currentUser.linkedin = linkedin;
                currentUser.github = github;
                currentUser.portfolio = portfolio;
                
                // Parse skills
                if (skillsStr) {
                    currentUser.skills = skillsStr.split(',').map(skill => skill.trim()).filter(Boolean);
                } else {
                    currentUser.skills = [];
                }
                
                // Save user data
                users[currentUserEmail] = currentUser;
                localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                
                // Update user name in sidebar
                const fullName = `${firstName} ${lastName}`.trim();
                document.querySelector('.user-name').textContent = fullName;
                
                // Update profile summary
                document.getElementById('profile-name').textContent = fullName;
                document.getElementById('profile-department').textContent = department || 'Not specified';
                
                // Recalculate profile completion percentage and update UI
                loadProfileData();
                
                // Show success message
                alert('Profile updated successfully!');
                
            } catch (error) {
                console.error("Error saving profile data:", error);
                alert(`Error saving profile data: ${error.message}`);
            }
        }
        
        // Function to view application details
        function viewApplicationDetails(applicationId) {
            console.log("Viewing application details:", applicationId);
            
            try {
                // Get application details
                const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
                const application = applications.find(app => app.id === applicationId);
                
                if (!application) {
                    alert('Application not found');
                    return;
                }
                
                // Get internship details
                const internships = JSON.parse(localStorage.getItem('campusConnectInternships')) || [];
                const internship = internships.find(i => i.id === application.internshipId) || {};
                
                // Get status color
                let statusColor = '#f59e0b'; // Default to warning/pending color
                let statusIcon = 'clock';
                
                if (application.status) {
                    if (application.status.toLowerCase() === 'accepted') {
                        statusColor = 'var(--success-color)';
                        statusIcon = 'check-circle';
                    } else if (application.status.toLowerCase() === 'rejected') {
                        statusColor = 'var(--danger-color)';
                        statusIcon = 'times-circle';
                    }
                }
                
                // Format dates
                const applicationDate = new Date(application.appliedDate).toLocaleDateString();
                const updatedDate = application.updatedDate ? new Date(application.updatedDate).toLocaleDateString() : 'N/A';
                
                // Create modal
                const modalHTML = `
                    <div class="modal" id="application-modal" style="display: flex;">
                        <div class="modal-content" style="max-width: 600px;">
                            <span class="close-btn" onclick="closeApplicationModal()">&times;</span>
                            
                            <div style="margin-bottom: 25px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span style="background-color: ${statusColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px;">
                                        <i class="fas fa-${statusIcon}"></i> ${application.status || 'Pending'}
                                    </span>
                                </div>
                                
                                <h2 style="color: var(--primary-color); margin-bottom: 5px;">${internship.title || application.internshipTitle || 'Unknown Position'}</h2>
                                <p style="color: var(--text-light); font-size: 1.1rem;">${internship.companyName || application.companyName || 'Unknown Company'}</p>
                            </div>
                            
                            <div style="background-color: #f8fafc; padding: 20px; border-radius: var(--border-radius); margin-bottom: 25px;">
                                <h3 style="margin-bottom: 15px; font-size: 1.1rem; color: var(--text-color);">Application Summary</h3>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Application ID</h4>
                                        <p style="font-size: 0.95rem;">${application.id}</p>
                                    </div>
                                    
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Applied On</h4>
                                        <p style="font-size: 0.95rem;">${applicationDate}</p>
                                    </div>
                                    
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Status Updated</h4>
                                        <p style="font-size: 0.95rem;">${updatedDate}</p>
                                    </div>
                                    
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Current Status</h4>
                                        <p style="font-size: 0.95rem; color: ${statusColor}; font-weight: 500;">${application.status || 'Pending'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            ${application.feedback ? `
                            <div style="margin-bottom: 25px;">
                                <h3 style="margin-bottom: 10px; font-size: 1.1rem; color: var(--text-color);">Feedback</h3>
                                <p style="line-height: 1.6; background-color: #f8fafc; padding: 15px; border-radius: var(--border-radius); font-style: italic;">${application.feedback}</p>
                            </div>
                            ` : ''}
                            
                            <div style="margin-bottom: 25px;">
                                <h3 style="margin-bottom: 15px; font-size: 1.1rem; color: var(--text-color);">Internship Details</h3>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                    ${internship.location ? `
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Location</h4>
                                        <p style="font-size: 0.95rem;">${internship.location}</p>
                                    </div>
                                    ` : ''}
                                    
                                    ${internship.duration ? `
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Duration</h4>
                                        <p style="font-size: 0.95rem;">${internship.duration}</p>
                                    </div>
                                    ` : ''}
                                    
                                    ${internship.stipend ? `
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Stipend</h4>
                                        <p style="font-size: 0.95rem;">${internship.stipend}</p>
                                    </div>
                                    ` : ''}
                                    
                                    ${internship.startDate ? `
                                    <div>
                                        <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 5px;">Start Date</h4>
                                        <p style="font-size: 0.95rem;">${new Date(internship.startDate).toLocaleDateString()}</p>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div style="text-align: right; margin-top: 30px;">
                                <button onclick="closeApplicationModal()" class="btn btn-outline">
                                    Close
                                </button>
                                
                                ${application.status && application.status.toLowerCase() === 'accepted' ? `
                                <button onclick="acceptOffer('${application.id}')" class="btn btn-success" style="margin-left: 10px;">
                                    Accept Offer
                                </button>
                                ` : ''}
                                
                                <button onclick="withdrawApplication('${application.id}')" class="btn" style="background-color: var(--danger-color); color: white; margin-left: 10px;">
                                    Withdraw Application
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Append modal to body
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHTML;
                document.body.appendChild(modalContainer.firstChild);
                
            } catch (error) {
                console.error("Error viewing application details:", error);
                alert("Error: " + error.message);
            }
        }
        
        // Function to close application modal
        function closeApplicationModal() {
            const modal = document.getElementById('application-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Function to withdraw an application
        function withdrawApplication(applicationId) {
            if (!confirm("Are you sure you want to withdraw this application? This action cannot be undone.")) {
                return;
            }
            
            try {
                // Get applications
                const applications = JSON.parse(localStorage.getItem('campusConnectApplications')) || [];
                const applicationIndex = applications.findIndex(app => app.id === applicationId);
                
                if (applicationIndex === -1) {
                    alert('Application not found');
                    return;
                }
                
                // Remove application
                const application = applications[applicationIndex];
                applications.splice(applicationIndex, 1);
                
                // Save updated applications
                localStorage.setItem('campusConnectApplications', JSON.stringify(applications));
                
                // Update internship's applicants list
                const internships = JSON.parse(localStorage.getItem('campusConnectInternships')) || [];
                const internshipIndex = internships.findIndex(i => i.id === application.internshipId);
                
                if (internshipIndex !== -1) {
                    const internship = internships[internshipIndex];
                    if (internship.applicants && Array.isArray(internship.applicants)) {
                        const applicantIndex = internship.applicants.indexOf(application.studentEmail);
                        if (applicantIndex !== -1) {
                            internship.applicants.splice(applicantIndex, 1);
                            localStorage.setItem('campusConnectInternships', JSON.stringify(internships));
                        }
                    }
                }
                
                // Close modal
                closeApplicationModal();
                
                // Show success message
                alert('Application withdrawn successfully');
                
                // Refresh dashboard
                loadDashboardData();
                
                // Refresh applications list if visible
                if (document.getElementById('my-applications-content').style.display !== 'none') {
                    loadStudentApplications();
                }
                
            } catch (error) {
                console.error("Error withdrawing application:", error);
                alert("Error: " + error.message);
            }
        }
        
        // Function to accept an offer
        function acceptOffer(applicationId) {
            alert("Congratulations! You have accepted the offer. Further instructions will be sent to your email.");
            closeApplicationModal();
        }

        // Function to render skills badges and chart
        function renderSkillsBadges(user) {
            const skillsBadgesContainer = document.getElementById('skills-badges');
            const skillsChartContainer = document.getElementById('skills-chart');
            
            if (!skillsBadgesContainer || !skillsChartContainer) {
                return;
            }
            
            // Clear containers
            skillsBadgesContainer.innerHTML = '';
            skillsChartContainer.innerHTML = '';
            
            // Check if user has skills
            if (!Array.isArray(user.skills) || user.skills.length === 0) {
                skillsBadgesContainer.innerHTML = `
                    <p style="color: var(--text-light); font-style: italic;">No skills added yet. Add your skills to improve your profile.</p>
                `;
                return;
            }
            
            // Initialize skill strengths if not present
            if (!user.skillStrengths) {
                user.skillStrengths = {};
            }
            
            // Create badges for each skill
            user.skills.forEach(skill => {
                // Initialize strength if not set
                if (!user.skillStrengths[skill]) {
                    user.skillStrengths[skill] = 7; // Default to 7 out of 10
                }
                
                // Create badge
                const badge = document.createElement('div');
                badge.className = 'skill-badge';
                badge.style.backgroundColor = '#f1f5f9';
                badge.style.color = 'var(--text-color)';
                badge.style.padding = '6px 12px';
                badge.style.borderRadius = '20px';
                badge.style.display = 'flex';
                badge.style.alignItems = 'center';
                badge.style.gap = '8px';
                badge.style.cursor = 'pointer';
                badge.style.transition = 'all 0.2s';
                
                badge.innerHTML = `
                    <span>${skill}</span>
                    <i class="fas fa-times-circle" style="color: var(--danger-color); font-size: 0.8rem;"></i>
                `;
                
                // Add hover effect
                badge.addEventListener('mouseover', function() {
                    badge.style.backgroundColor = '#e2e8f0';
                });
                
                badge.addEventListener('mouseout', function() {
                    badge.style.backgroundColor = '#f1f5f9';
                });
                
                // Add click handler to remove skill
                badge.querySelector('i').addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    if (confirm(`Remove "${skill}" from your skills?`)) {
                        // Remove skill from array
                        const skillIndex = user.skills.indexOf(skill);
                        if (skillIndex !== -1) {
                            user.skills.splice(skillIndex, 1);
                        }
                        
                        // Remove strength data
                        if (user.skillStrengths && user.skillStrengths[skill]) {
                            delete user.skillStrengths[skill];
                        }
                        
                        // Save to localStorage
                        const users = JSON.parse(localStorage.getItem('campusConnectUsers')) || {};
                        const currentUserEmail = localStorage.getItem('currentUserEmail');
                        users[currentUserEmail] = user;
                        localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                        
                        // Update textarea
                        document.getElementById('skills').value = user.skills.join(', ');
                        
                        // Re-render badges
                        renderSkillsBadges(user);
                        
                        // Recalculate profile completion
                        loadProfileData();
                    }
                });
                
                // Add click handler to edit skill strength
                badge.addEventListener('click', function() {
                    const strength = prompt(`Rate your proficiency in "${skill}" from 1-10:`, user.skillStrengths[skill]);
                    
                    if (strength !== null) {
                        const strengthNum = parseInt(strength);
                        
                        if (isNaN(strengthNum) || strengthNum < 1 || strengthNum > 10) {
                            alert('Please enter a valid number between 1 and 10.');
                            return;
                        }
                        
                        // Update strength
                        user.skillStrengths[skill] = strengthNum;
                        
                        // Save to localStorage
                        const users = JSON.parse(localStorage.getItem('campusConnectUsers')) || {};
                        const currentUserEmail = localStorage.getItem('currentUserEmail');
                        users[currentUserEmail] = user;
                        localStorage.setItem('campusConnectUsers', JSON.stringify(users));
                        
                        // Re-render chart
                        renderSkillsBadges(user);
                    }
                });
                
                skillsBadgesContainer.appendChild(badge);
                
                // Add skill to chart
                const strength = user.skillStrengths[skill];
                const strengthPercentage = (strength / 10) * 100;
                
                // Color based on strength
                let barColor;
                if (strength <= 3) {
                    barColor = 'var(--danger-color)';
                } else if (strength <= 6) {
                    barColor = 'var(--warning-color)';
                } else {
                    barColor = 'var(--success-color)';
                }
                
                const chartItem = document.createElement('div');
                chartItem.className = 'skill-chart-item';
                chartItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-weight: 500;">${skill}</span>
                        <span style="color: var(--text-light);">${strength}/10</span>
                    </div>
                    <div style="height: 8px; background-color: #e2e8f0; border-radius: 4px;">
                        <div style="height: 100%; width: ${strengthPercentage}%; background-color: ${barColor}; border-radius: 4px;"></div>
                    </div>
                `;
                
                skillsChartContainer.appendChild(chartItem);
            });
        }

        // Function to load user profile images in all places
        function loadUserProfileImages(userData) {
            console.log("Loading user profile images");
            
            if (!userData) return;
            
            const sidebarProfileImage = document.getElementById('sidebar-profile-image');
            const sidebarProfileIcon = document.getElementById('sidebar-profile-icon');
            const topbarProfileImage = document.getElementById('topbar-profile-image');
            const topbarProfileIcon = document.getElementById('topbar-profile-icon');
            
            if (userData.profileImage) {
                // Update sidebar avatar
                if (sidebarProfileImage && sidebarProfileIcon) {
                    sidebarProfileImage.src = userData.profileImage;
                    sidebarProfileImage.style.display = 'block';
                    sidebarProfileIcon.style.display = 'none';
                }
                
                // Update topbar avatar
                if (topbarProfileImage && topbarProfileIcon) {
                    topbarProfileImage.src = userData.profileImage;
                    topbarProfileImage.style.display = 'block';
                    topbarProfileIcon.style.display = 'none';
                }
            } else {
                // Reset sidebar avatar
                if (sidebarProfileImage && sidebarProfileIcon) {
                    sidebarProfileImage.style.display = 'none';
                    sidebarProfileIcon.style.display = 'block';
                }
                
                // Reset topbar avatar
                if (topbarProfileImage && topbarProfileIcon) {
                    topbarProfileImage.style.display = 'none';
                    topbarProfileIcon.style.display = 'block';
                }
            }
        }
    </script>

    <!-- Load additional scripts -->
    <script src="load-applications.js"></script>
    <script src="fix-navigation.js"></script>
    <script src="fix-internship-connections.js"></script>
    <!-- Place script tags at the end of the body for better performance -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="socket-client.js"></script>
    <script src="student-chat.js"></script>
</body>
</html> 